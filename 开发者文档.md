## ğŸ“˜ Web åŸ‹ç‚¹ SDK ä½¿ç”¨æ–‡æ¡£


### ğŸ“Œ ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡

æœ¬ SDK æ—¨åœ¨ä¸ºè·¨å¢ƒç”µå•†ç½‘ç«™æä¾›**é«˜æ€§èƒ½ã€ä½ä¾µå…¥ã€å¯é…ç½®**çš„å‰ç«¯è¡Œä¸ºåŸ‹ç‚¹èƒ½åŠ›ï¼Œæ”¯æŒåŒ¿åç”¨æˆ·è¿½è¸ªã€å¤šå¹³å°æ•°æ®è½¬å‘ã€è‡ªå®šä¹‰äº‹ä»¶é‡‡é›†å’Œè®¾å¤‡ç¯å¢ƒä¸»åŠ¨è¯†åˆ«ç­‰èƒ½åŠ›ï¼Œ**æ”¯æŒæ— ç™»å½•ä¸‹å•çš„ç‹¬ç«‹ç«™ç‚¹è¡Œä¸ºé‡‡é›†éœ€æ±‚**ã€‚

---

### ğŸš§ äºŒã€å¼€å‘è¿­ä»£ç›®æ ‡

#### âœ… V1.0

* æ”¯æŒåŒ¿å ID ç”Ÿæˆä¸æœ¬åœ°æŒä¹…åŒ–
* æä¾› track() æ¥å£ä¸»åŠ¨ä¸ŠæŠ¥
* å†…ç½® page\_view è‡ªåŠ¨ä¸ŠæŠ¥
* æ”¯æŒé˜Ÿåˆ— + èŠ‚æµ + åˆ†æ®µæ‰¹é‡å‘é€æœºåˆ¶
* æä¾› init é…ç½®åˆå§‹åŒ–
* æ”¯æŒ debug ä¸æ§åˆ¶å°è¾“å‡ºå¼€å…³

#### âœ… V1.1

* å¢åŠ è®¾å¤‡ä¿¡æ¯è‡ªåŠ¨æ”¶é›†ï¼ˆUAã€åˆ†è¾¨ç‡ã€å¹³å°ã€è¯­è¨€ã€æµè§ˆå™¨ç­‰ï¼‰
* å¢åŠ ç½‘ç»œçŠ¶æ€ã€å†…å­˜ã€çº¿ç¨‹æ•°ã€é¦–å¸§åŠ è½½æ—¶é—´ç­‰ä¸»åŠ¨æŒ‡æ ‡é‡‡é›†
* æä¾› asyncContextResolver æ¥å£æ”¯æŒå¼‚æ­¥ä¸Šä¸‹æ–‡ï¼ˆå¦‚åŸå¸‚ã€ç”¨æˆ·ç­‰çº§ï¼‰æ³¨å…¥

#### âœ… V1.2

* å¢åŠ äº‹ä»¶å¤šå¹³å°è½¬å‘æœºåˆ¶ï¼ˆå¯é…ç½® handlerï¼Œå¦‚ Googleã€Xï¼‰
* å¢åŠ å¯æ‰©å±•æ§åˆ¶å­—æ®µï¼ˆtrackLogSwitch / flushMaxBatch / flushIntervalï¼‰

---

### ğŸ“¦ ä¸‰ã€åŠŸèƒ½æ¨¡å—è¯´æ˜

#### 1ï¸âƒ£ åˆå§‹åŒ–é…ç½®

```js
CrossTracker.init({
  server: '/track',
  projectId: 'global-store',
  debug: true,
  trackLogSwitch: true,
  flushMaxBatch: 20,
  asyncContextResolver: async () => {
    const cityInfo = await getCityFromService();
    const user = window.userInfo || {};
    return {
      loginState: !!user.uid,
      city: cityInfo?.city,
      country: cityInfo?.country,
      level: user.level || 'guest'
    };
  }
})
```

#### 2ï¸âƒ£ åŸ‹ç‚¹äº‹ä»¶ä¸ŠæŠ¥

```js
CrossTracker.track('product_view', {
  sku: 'A123456',
  price: 18.99,
  currency: 'USD'
})
```

#### 3ï¸âƒ£ è‡ªåŠ¨åŸ‹ç‚¹äº‹ä»¶

* é¡µé¢è®¿é—®ï¼š`page_view`
* é¡µé¢å…³é—­ï¼šè§¦å‘ flushQueue

#### 4ï¸âƒ£ å¼‚æ­¥ä¸Šä¸‹æ–‡æ”¯æŒï¼ˆå»¶è¿Ÿæ‹‰å–ï¼‰

* å…¸å‹åº”ç”¨åœºæ™¯ï¼šIP å®šä½ã€ç™»å½•æ€åˆ¤æ–­ã€AB å®éªŒç»„æ³¨å…¥ç­‰

#### 5ï¸âƒ£ å¤šå¹³å°äº‹ä»¶è½¬å‘ï¼ˆå¯é€‰ï¼‰

```js
forwardPipelines: [
  {
    name: 'google',
    handler: (batch) => {
      batch.forEach(evt => window.gtag('event', evt.event, evt.data))
    }
  }
]
```

---

### ğŸ”§ å››ã€é›†æˆä¸éƒ¨ç½²æŒ‡å—

#### âœ… æ–¹å¼ä¸€ï¼šCDN åŠ è½½

```html
<script src="/js/cross-tracker-sdk.js"></script>
<script>
  CrossTracker.init({ ... })
</script>
```

#### âœ… æ–¹å¼äºŒï¼šES æ¨¡å—åŒ–æ¥å…¥ï¼ˆæ”¯æŒ webpack / viteï¼‰

```js
import CrossTracker from './cross-tracker-sdk.js'
CrossTracker.init({ ... })
```

#### âœ… æ–¹å¼ä¸‰ï¼šæ’ä»¶åŒ–æ¥å…¥åˆ°å‰ç«¯æ¡†æ¶ä¸­

* Vueï¼šåœ¨ `beforeMount()` æ‰§è¡Œåˆå§‹åŒ–
* Reactï¼šåœ¨ `useEffect(() => { ... }, [])` ä¸­åˆå§‹åŒ–

---

### ğŸ“Š äº”ã€åç«¯å¯¹æ¥è¯´æ˜ï¼ˆç¤ºæ„ï¼‰

* æ¥å£è·¯å¾„ï¼š`POST /track`
* è¯·æ±‚ä½“ï¼šæ‰¹é‡ JSON æ•°ç»„
* æ¯æ¡ç»“æ„ç¤ºä¾‹ï¼š

```json
{
  "event": "add_to_cart",
  "ts": "2025-05-12T08:00:00Z",
  "user": {
    "uid": null,
    "anonymousId": "uuid-1234"
  },
  "page": {
    "url": "https://store.com/detail/123",
    "referrer": "https://google.com"
  },
  "device": { "ua": "...", "lang": "...", ... },
  "context": { "loginState": false, "city": "Tokyo" },
  "data": { "sku": "A1234", "price": 18.99 }
}
```

---

### ğŸ§  å…­ã€å¸¸è§åº”ç”¨åœºæ™¯

| åœºæ™¯    | äº‹ä»¶å              | é™„åŠ æ•°æ®ç¤ºä¾‹                           |
| ----- | ---------------- | -------------------------------- |
| é¦–é¡µæ›å…‰  | page\_view       | { pageType: 'home' }             |
| å•†å“æµè§ˆ  | product\_view    | { sku: 'A123', price: 9.9 }      |
| æœç´¢æ“ä½œ  | search           | { keyword: 'summer hat' }        |
| åŠ å…¥è´­ç‰©è½¦ | add\_to\_cart    | { sku: 'A123', quantity: 1 }     |
| ä¸‹å•ç»“ç®—  | place\_order     | { orderId: 'O987', total: 59.9 } |
| æ”¯ä»˜å®Œæˆ  | payment\_success | { method: 'paypal' }             |

---

### âœ… ä¸ƒã€åŸ‹ç‚¹è®¾è®¡åŸåˆ™å»ºè®®

1. æ‰€æœ‰äº‹ä»¶ä½¿ç”¨è‹±æ–‡å‘½å + å°å†™ä¸‹åˆ’çº¿æ ¼å¼ï¼ˆå¦‚ `product_view`ï¼‰
2. é™„åŠ æ•°æ®å¿…é¡»æ˜¯ç»“æ„åŒ–å­—æ®µï¼Œé¿å…ä¼ å­—ç¬¦ä¸²æ‹¼æ¥å€¼
3. ä¸ŠæŠ¥æ•°æ®**å°½é‡ä¸è¦åŒ…å« PIIï¼ˆä¸ªäººè¯†åˆ«ä¿¡æ¯ï¼‰**ï¼Œå¦‚æ‰‹æœºå·ã€æ˜æ–‡åœ°å€ç­‰
4. ä½¿ç”¨ `context` æºå¸¦å¹³å°çº§é€šç”¨ä¿¡æ¯ï¼Œé¿å…æ±¡æŸ“ data
5. ä¿æŒ track æ¥å£åªåšåŸ‹ç‚¹ï¼Œä¸å¼•å…¥ä¸šåŠ¡é€»è¾‘

---

